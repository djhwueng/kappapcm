---
title: "Script that generates Fig 2"
output:
  html_document: 
    toc: true
    number_sections: false
    theme: united
    highlight: tango
  pdf_document: default
---

```{r}
rm(list=ls())
library(ape)
setwd("~/Dropbox/JournalSubmission/EvolutionaryBioinformatics-kappa/code_MajorRevision/")
myenv<-new.env()
load("opentree_chronograms.rda",env=myenv)
ls(envir=myenv)
#myenv$datelife.cache$dois

taxa.size.array<-c()
for(index in 1:130){
  taxa.size.array<-c(taxa.size.array,length(myenv$datelife.cache$trees[[index]]$tip.label))
}
taxa.size.array
length(myenv$datelife.cache$trees[[34]]$tip.label)

median(taxa.size.array[-c(23,24,25,34)])
mean(taxa.size.array[-c(23,24,25,34)])


taxa.kappa.array<-array(0,c(130,2))
for(index in 1:130){
#  print(index)
  if(index != 23 & index != 24 & index != 25 & index != 34){#exclude the tree with 48016 taxa
    tree<-myenv$datelife.cache$trees[[index]]
    taxa.kappa.array[index,1]<-length(tree$tip.label)
    taxa.kappa.array[index,2]<-kappa(vcv(tree))
    }
  }

taxa.kappa.array<-taxa.kappa.array[-c(23,24,25,34),]

taxa.kappa.array<-data.frame(taxa=taxa.kappa.array[,1],kappa=taxa.kappa.array[,2])

plot(taxa.kappa.array$taxa, log(taxa.kappa.array$kappa))


library(ggplot2)
ggplot(data=taxa.kappa.array,mapping = aes(x=taxa,y=log(kappa))) + geom_point( color = "blue") + 
geom_smooth(method=lm, se=FALSE, color="black") +
labs(title="          kappa vs. taxa (Real Data)", y = "log kappa", x="number of taxa")  + theme_classic()

lm(log(kappa) ~ taxa, data=taxa.kappa.array)
#Coefficients:
#  (Intercept)         taxa  
#   5.176112     0.006025  

# The intercept of 0.006 is the log of geometric mean of kappa.
# We can say that one-unit increase in taxa, we can expect to see \exp(0.006025) \approx 1.006 \approx 0.6 % increase in kappa value.
```
